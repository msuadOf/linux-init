# 开启代理
function proxy_on(){
    
    # 默认值
    IP="127.0.0.1"
    PORT="7890"
    
    # WSL的特殊默认值
    if cat /proc/sys/kernel/osrelease 2>/dev/null | grep -qi "microsoft"; then
        IP=$(ip route | grep default | awk '{print $3}')
        PORT="7897"
    fi

    # 根据参数数量处理
    case $# in
        0)
            # 无参数，使用默认值
            ;;
        1)
            # 一个参数
            if [[ "$1" =~ ^[0-9]+$ ]]; then
                # 纯数字，当作PORT
                PORT="$1"
            elif [[ "$1" =~ : ]]; then
                # 包含冒号，拆分IP和PORT
                IFS=':' read -r IP PORT <<< "$1"
            else
                # 其他情况，当作IP
                IP="$1"
            fi
            ;;
        *)
            # 两个或多个参数，前两个作为IP和PORT
            IP="$1"
            PORT="$2"
            ;;
    esac
    
    # 设置代理环境变量
    export all_proxy="socks5://${IP}:${PORT}"
    export http_proxy="http://${IP}:${PORT}"
    export https_proxy="http://${IP}:${PORT}"
    export ALL_PROXY="socks5://${IP}:${PORT}"
    export HTTP_PROXY="http://${IP}:${PORT}"
    export HTTPS_PROXY="http://${IP}:${PORT}"
    
}

# 关闭代理
function proxy_off(){
    unset all_proxy
    unset http_proxy
    unset https_proxy
	unset ALL_PROXY
    unset HTTP_PROXY
    unset HTTPS_PROXY
}

function proxy_test(){
    case $# in
        0)
            echo "all_proxy   = $all_proxy  "
            echo "http_proxy  = $http_proxy "
            echo "https_proxy = $https_proxy"
	        echo "ALL_PROXY   = $ALL_PROXY  "
            echo "HTTP_PROXY  = $HTTP_PROXY "
            echo "HTTPS_PROXY = $HTTPS_PROXY"
            echo "==================="
            echo "[curl -I https://www.google.com]:"
            curl -I https://www.google.com
            ;;
        *)
            proxy_on $@
            proxy_test
            ;;
    esac
}

function on(){
    proxy_on $@
    echo -e "proxy_on: 已开启代理" "${IP}:${PORT}"
}

function off(){
    proxy_off $@
    echo -e "proxy_off: 已关闭代理"
}

function test(){
    proxy_test $@
}

alias t=test